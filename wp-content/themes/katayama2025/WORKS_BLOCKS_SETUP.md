# 施工実績ページ - Gutenbergカスタムブロック セットアップガイド

## ✅ 実装完了内容

### 作成したブロック
1. **📸 カルーセルギャラリーブロック**
   - 複数画像のスライドショー表示
   - 自動再生機能
   - サムネイル表示
   - ナビゲーションボタン

2. **🔄 ビフォーアフター比較ブロック**
   - 工事前後の画像比較
   - スライダーでドラッグ比較
   - 説明文の追加

### 制限事項
- ✅ **works投稿タイプのみ**で使用可能
- ✅ 他のページには影響なし
- ✅ 既存の施工実績ページはそのまま動作

---

## 🛠 セットアップ手順

### 1. 依存関係のインストール

**ホストマシンから実行:**
```bash
cd /path/to/wp-content/themes/katayama2025
npm install
```

**インストールされるパッケージ:**
- `swiper` - カルーセル機能
- `@dnd-kit/core` - ドラッグ&ドロップ機能
- `@dnd-kit/sortable` - 画像の並び替え機能
- `@dnd-kit/utilities` - ユーティリティ関数

---

### 2. ビルド実行

**開発モード（リアルタイムプレビュー）:**
```bash
npm run dev
```

**本番ビルド:**
```bash
npm run build
```

---

### 3. WordPressでの使用方法

#### 新しい施工実績を作成
1. WordPress管理画面 → **施工実績** → **新規追加**
2. ブロック追加ボタン「+」をクリック
3. カテゴリ「**カタヤマ（施工実績専用）**」が表示される
4. 以下のブロックを選択：
   - 📸 **カルーセルギャラリー**
   - 🔄 **ビフォーアフター比較**

#### カルーセルギャラリーの使い方
1. ブロックを追加すると画像アップロードが表示される
2. 「画像を追加」から複数の画像を選択
3. ドラッグ&ドロップで並び順を変更可能
4. 右サイドバーで設定：
   - ✅ 自動再生: ON/OFF
   - ⏱ スライド速度: 2秒〜10秒
   - 🖼️ サムネイル表示: ON/OFF

#### ビフォーアフター比較の使い方
1. ブロックを追加すると2つの画像エリアが表示される
2. Before（工事前）画像をアップロード
3. After（工事後）画像をアップロード
4. 説明文を入力（任意）
5. 右サイドバーで設定：
   - スライダー初期位置: 0%〜100%

---

## 📸 使用例

### 施工実績ページの構成例
```
┌─────────────────────────────────────┐
│ タイトル: ○○マンション大規模修繕      │
├─────────────────────────────────────┤
│ ACF: 完成年（2024）                  │
│ ACF: 住所（東京都...）               │
├─────────────────────────────────────┤
│ [段落ブロック]                       │
│ この物件は2024年に施工した...        │
│                                     │
│ [📸 カルーセルギャラリー]             │
│ ← 施工写真10枚 →                    │
│                                     │
│ [見出しブロック]                     │
│ ## 外壁塗装について                  │
│                                     │
│ [🔄 ビフォーアフター比較]             │
│ Before ← → After                    │
│ 説明: 外壁塗装の様子                 │
│                                     │
│ [段落ブロック]                       │
│ 工事期間は6ヶ月...                  │
└─────────────────────────────────────┘
```

---

## 🔍 確認事項

### ブロックが表示されるか確認
1. **施工実績**編集画面 → ブロック追加「+」
2. 「カタヤマ（施工実績専用）」カテゴリが表示されるか

### 固定ページでは表示されないか確認
1. **固定ページ**編集画面 → ブロック追加「+」
2. 「カタヤマ（施工実績専用）」カテゴリが**表示されない**ことを確認

---

## 🐛 トラブルシューティング

### ブロックが表示されない場合
```bash
# 1. キャッシュクリア
rm -rf node_modules/.vite
rm -rf dist

# 2. 再ビルド
npm install
npm run build

# 3. WordPressのキャッシュクリア
WordPress管理画面 → プラグイン → キャッシュクリア
```

### ビルドエラーが出る場合
```bash
# Node.jsのバージョン確認（v18以上推奨）
node -v

# package-lock.jsonを削除して再インストール
rm -f package-lock.json
rm -rf node_modules
npm install
```

### フロントエンドで動作しない場合
```bash
# ブラウザのコンソールでエラー確認
F12 → Console タブ

# Swiper.jsが読み込まれているか確認
console.log(typeof Swiper); // "function" と表示されるべき
```

---

## 📝 既存コードとの共存

### Instagram型ギャラリー（works_gallery CPT）
- 既存のworks_gallery CPTは**そのまま動作**
- 新規投稿はGutenbergブロック推奨
- 両方存在する場合、Gutenbergブロックが優先表示

### ACFフィールド
- 基本情報（完成年、住所）はACFのまま
- 画像関連のみGutenbergブロック

---

## 🎨 カスタマイズ

### カルーセルの色を変更
`src/blocks/gallery-carousel/style.scss` を編集:
```scss
.swiper-pagination-bullet-active {
  background: #YOUR_COLOR; // ここを変更
}
```

### ビフォーアフターのスライダー色を変更
`src/blocks/before-after/style.scss` を編集:
```scss
.slider-button {
  background: #YOUR_COLOR; // ここを変更
}
```

変更後は `npm run build` を実行。

---

## ✨ 次のステップ

1. [ ] `npm install` 実行
2. [ ] `npm run build` 実行
3. [ ] WordPress管理画面で施工実績を編集
4. [ ] カスタムブロックが使えることを確認
5. [ ] フロントエンドで正しく表示されることを確認

---

## 📞 サポート

問題が発生した場合は、Issue #26 にコメントしてください。
https://github.com/ikazukin/2025katayama-web/issues/26
